### 线程安全

当多个线程访问同一个可变的状态时，为了确保线程安全，可以采取的措施：

1. 不在线程之间共享该状态变量
2. 将状态变量修改为不可变的变量
3. 在访问状态变量时使用同步

### 加锁机制

要保持状态的一致性，需要在单个原子操作中更新所有相关的状态变量

#### 内置锁

**同步代码块(Synchronized Block)**：

- 作为锁的对象引用
- 作为由这个锁保护的代码块

#### 重入

当某个线程请求一个由其他线程持有的锁时，发出请求的线程会阻塞。由于内置锁的 **可重入性**，如果某个线程试图获取已经由其持有的锁，请求会成功。

- **重入** 意味着获取锁的操作的粒度是 **线程**, 重入的一种实现方法是，为每个锁关联一个获取计数值和一个所有者线程。同一线程获取锁，计数值递增
- 子类改写父类的synchronized方法，然后调用父类的方法

**重入的实现方法**：为每个锁关联一个获取计数值和所有者线程。

#### 用锁来保护状态

- 对于可能被多个线程同时访问的可变状态变量，在访问他的时都需要持有同一个锁。
- 每个共享的和可变的变量由一个锁来保护